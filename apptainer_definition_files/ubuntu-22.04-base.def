Bootstrap: docker
From: ubuntu:22.04
Stage: build

%setup


%environment
    ### Set program locations/versions for system PATH ###
    programs_location="/srlab/programs"
    bowtie2_version="2.5.4"
    fastqc_version="0.12.1"
    gffcompare_version="gffcompare-0.12.6"
    hisat2_version="2.2.1"
    ncbi_blast_version="2.16.0"
    samtools_version="1.20"
    stringtie_version="2.2.1"

    ######################################################

    export LC_ALL=C
    
    ### Set container system PATH ###
    PATH="/usr/local/sbin:\
/usr/local/bin:/usr/sbin:\
/usr/bin:\
/sbin:\
/bin:\
${programs_location}:\
${programs_location}/bowtie2-${bowtie2_version}-sra-linux-x86_64:\
${programs_location}/FastQC-${fastqc_version}:\
${programs_location}/${gffcompare_version}:\
${programs_location}/hisat2-${hisat2_version}:\
${programs_location}/ncbi-blast-${ncbi_blast_version}+/bin:\
${programs_location}/samtools-${samtools_version}:\
${programs_location}/stringtie-${stringtie_version}.Linux_x86_64"
    ######################################################


%post
    # Install common/base libraries/dependencies
    apt update && \
    apt install -y --no-install-recommends \
    apt-utils \
    aptitude \
    automake \
    build-essential \
    bzip2 \
    cmake \
    coreutils \
    curl \
    debconf \
    default-jdk \
    dialog \
    emboss \
    gcc-multilib \
    gdebi-core \
    gfortran \
    git \
    gobjc++ \
    hmmer \
    htop \
    infernal \
    libapparmor1 \
    libbz2-dev \
    libc6 \
    libcurl4-openssl-dev \
    libedit2 \
    libfontconfig1 \
    liblzma-dev \
    libncurses5-dev \
    libncurses-dev \
    libncursesw5-dev \
    libpango1.0-dev \
    libpng-dev \
    libreadline-dev \
    libsm6 \
    libsparsehash-dev \
    libssl-dev \
    liburi-escape-xs-perl \
    liburi-perl \
    libxrender1 \
    libzmq3-dev \
    locales \
    locales-all \
    man \
    nano \
    ncurses-dev \
    net-tools \
    parallel \
    pkg-config \
    psmisc \
    python3 \
    python-setuptools \
    rsync \
    ruby \
    software-properties-common \
    sqlite3 \
    sudo \
    texinfo \
    tree \
    unzip \
    wget \
    xorg-dev \
    zlib1g-dev

    # Make programs directory
    mkdir --parents /srlab/programs
    cd /srlab/programs

    # Set threads for faster builds
    threads="40"

    ########## Set program versions ##########

    bedtools_version="v2.31.0"
    bowtie2_version="2.5.4"
    fastqc_version="0.12.1"
    gffcompare_version="gffcompare-0.12.6"
    hisat2_version="2.2.1"
    ncbi_blast_version="2.16.0"
    stringtie_version="2.2.1"
    samtools_version="1.20"

    ##########################################

    # Change to installation directory
    cd /srlab/programs

    # Install bedtools
    wget https://github.com/arq5x/bedtools2/releases/download/${bedtools_version}/bedtools.static
    mv bedtools.static bedtools
    chmod a+x bedtools

    # Install bowtie2
    wget https://github.com/BenLangmead/bowtie2/releases/download/v${bowtie2_version}/bowtie2-${bowtie2_version}-sra-linux-x86_64.zip
    unzip bowtie2-${bowtie2_version}-sra-linux-x86_64.zip
    rm bowtie2-${bowtie2_version}-sra-linux-x86_64.zip

    # Install FastQC
    wget https://github.com/s-andrews/FastQC/archive/refs/tags/v${fastqc_version}.zip
    unzip v${fastqc_version}.zip


    # Install gffcompare
    wget http://ccb.jhu.edu/software/stringtie/dl/${gffcompare_version}.Linux_x86_64.tar.gz
    tar -xzvf ${gffcompare_version}.Linux_x86_64.tar.gz
    rm ${gffcompare_version}.Linux_x86_64.tar.gz


    # Install HISAT2
    wget https://github.com/DaehwanKimLab/hisat2/archive/refs/tags/v${hisat2_version}.tar.gz
    tar -xzvf v${hisat2_version}.tar.gz
    cd hisat2-${hisat2_version}
    make -j ${threads}
    cd -
    rm v${hisat2_version}.tar.gz

    # Install NCBI BLAST
    wget ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/${ncbi_blast_version}/ncbi-blast-${ncbi_blast_version}+-x64-linux.tar.gz \
	&& tar -zxvpf ncbi-blast-${ncbi_blast_version}+-x64-linux.tar.gz \
	&& rm ncbi-blast-${ncbi_blast_version}+-x64-linux.tar.gz

    # Install samtools
    wget https://github.com/samtools/samtools/releases/download/${samtools_version}/samtools-${samtools_version}.tar.bz2
    tar -xjvf samtools-${samtools_version}.tar.bz2
    cd samtools-${samtools_version}
    ./configure
    make -j ${threads}
    cd -
    rm samtools-${samtools_version}.tar.bz2

    # Install StringTie
    wget http://ccb.jhu.edu/software/stringtie/dl/stringtie-${stringtie_version}.Linux_x86_64.tar.gz
    tar -xzvf stringtie-${stringtie_version}.Linux_x86_64.tar.gz
    rm stringtie-${stringtie_version}.Linux_x86_64.tar.gz




%labels
    Author Sam White
    Version v0.0.4

%help
    This is an Apptainer definition file for an Ubuntu container containing bioinformatics software for the Roberts Lab.
